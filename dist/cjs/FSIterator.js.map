{"version":3,"sources":["FSIterator.js"],"sourcesContent":["const inherits = require('inherits');\nconst StackBaseIterator = require('stack-base-iterator');\nconst fs = require('fs');\nconst path = require('path');\n\nconst PathStack = require('./PathStack');\nconst fifoRemove = require('./fifoRemove');\nconst fsCompat = require('./fs-compat');\nconst lifoFromArray = require('./lifoFromArray');\n\nfunction FSIterator(root, options) {\n  if (!(this instanceof FSIterator)) return new FSIterator(root, options);\n  StackBaseIterator.call(this, options);\n  options = options || {};\n\n  if (this.options.depth === undefined) this.options.depth = Infinity;\n  this.options.readdir = { encoding: 'utf8', withFileTypes: fs.Dirent && !options.alwaysStat };\n  this.options.stat = { bigint: process.platform === 'win32' };\n  this.options.error =\n    options.error ||\n    function defaultError(err) {\n      return ~FSIterator.EXPECTED_ERRORS.indexOf(err.code); // skip known issues\n    };\n\n  this.root = path.resolve(root);\n  this.stack = new PathStack();\n  let cancelled = false;\n  function setup() {\n    cancelled = true;\n  }\n  this.processing.push(setup);\n  fsCompat.readdir(this.root, this.options.readdir, (err, files) => {\n    fifoRemove(this.processing, setup);\n    if (this.done || cancelled) return;\n    if (err) return this.end(err);\n    if (files.length) this.push({ path: null, depth: 0, files: lifoFromArray(files) });\n  });\n}\n\ninherits(FSIterator, StackBaseIterator);\n\nFSIterator.EXPECTED_ERRORS = ['ENOENT', 'EPERM', 'EACCES', 'ELOOP'];\n\nmodule.exports = FSIterator;\n"],"names":["inherits","require","StackBaseIterator","fs","path","PathStack","fifoRemove","fsCompat","lifoFromArray","FSIterator","root","options","call","depth","undefined","Infinity","readdir","encoding","withFileTypes","Dirent","alwaysStat","stat","bigint","process","platform","error","defaultError","err","EXPECTED_ERRORS","indexOf","code","resolve","stack","cancelled","setup","processing","push","files","done","end","length","module","exports"],"mappings":";;;;;;;;AAAA,IAAMA,WAAWC,QAAQ;AACzB,IAAMC,oBAAoBD,QAAQ;AAClC,IAAME,KAAKF,QAAQ;AACnB,IAAMG,OAAOH,QAAQ;AAErB,IAAMI,YAAYJ,QAAQ;AAC1B,IAAMK,aAAaL,QAAQ;AAC3B,IAAMM,WAAWN,QAAQ;AACzB,IAAMO,gBAAgBP,QAAQ;AAE9B,SAASQ,WAAWC,IAAI,EAAEC,OAAO;;IAC/B,IAAI,CAAE,AAAI,YAAJ,IAAI,EAAYF,aAAa,OAAO,IAAIA,WAAWC,MAAMC;IAC/DT,kBAAkBU,IAAI,CAAC,IAAI,EAAED;IAC7BA,UAAUA,WAAW,CAAC;IAEtB,IAAI,IAAI,CAACA,OAAO,CAACE,KAAK,KAAKC,WAAW,IAAI,CAACH,OAAO,CAACE,KAAK,GAAGE;IAC3D,IAAI,CAACJ,OAAO,CAACK,OAAO,GAAG;QAAEC,UAAU;QAAQC,eAAef,GAAGgB,MAAM,IAAI,CAACR,QAAQS,UAAU;IAAC;IAC3F,IAAI,CAACT,OAAO,CAACU,IAAI,GAAG;QAAEC,QAAQC,QAAQC,QAAQ,KAAK;IAAQ;IAC3D,IAAI,CAACb,OAAO,CAACc,KAAK,GAChBd,QAAQc,KAAK,IACb,SAASC,aAAaC,GAAG;QACvB,OAAO,CAAClB,WAAWmB,eAAe,CAACC,OAAO,CAACF,IAAIG,IAAI,GAAG,oBAAoB;IAC5E;IAEF,IAAI,CAACpB,IAAI,GAAGN,KAAK2B,OAAO,CAACrB;IACzB,IAAI,CAACsB,KAAK,GAAG,IAAI3B;IACjB,IAAI4B,YAAY;IAChB,SAASC;QACPD,YAAY;IACd;IACA,IAAI,CAACE,UAAU,CAACC,IAAI,CAACF;IACrB3B,SAASS,OAAO,CAAC,IAAI,CAACN,IAAI,EAAE,IAAI,CAACC,OAAO,CAACK,OAAO,EAAE,SAACW,KAAKU;QACtD/B,WAAW,MAAK6B,UAAU,EAAED;QAC5B,IAAI,MAAKI,IAAI,IAAIL,WAAW;QAC5B,IAAIN,KAAK,OAAO,MAAKY,GAAG,CAACZ;QACzB,IAAIU,MAAMG,MAAM,EAAE,MAAKJ,IAAI,CAAC;YAAEhC,MAAM;YAAMS,OAAO;YAAGwB,OAAO7B,cAAc6B;QAAO;IAClF;AACF;AAEArC,SAASS,YAAYP;AAErBO,WAAWmB,eAAe,GAAG;IAAC;IAAU;IAAS;IAAU;CAAQ;AAEnEa,OAAOC,OAAO,GAAGjC"}